import type grapesjs from 'grapesjs';
import { PluginOptions } from '../types';
import {
  cmdClear,
  cmdDeviceDesktop,
  cmdDeviceMobile,
  cmdDeviceTablet,
} from '../consts';

export default (editor: grapesjs.Editor, opts: Required<PluginOptions>) => {
  const { Panels } = editor;
  const { cmdOpenImport, cmdTglImages } = opts;
  const openExport = 'export-template';
  const openStyleManager = 'open-sm';
  const openTraits = 'open-tm';
  const openLayers = 'open-layers';
  const openBlocks = 'open-blocks';
  const activateOutline = 'sw-visibility';
  const activateFullscreen = 'fullscreen';
  const activatePreview = 'preview';
  const iconStyle = 'style="display: block; max-width: 22px"';

  // Turn off default devices select and create new one
  editor.getConfig().showDevices = false;

  Panels.getPanels().reset([
    {
      id: 'commands',
      buttons: [{}],
    },
    {
      id: 'devices-c',
      buttons: [
        {
          id: cmdDeviceDesktop,
          command: cmdDeviceDesktop,
          active: true,
          label: `<svg ${iconStyle} width="20" height="20" viewBox="0 0 20 20"">
          <path fill="currentColor" d="M15.9591 4.77344L4.60156 4.77344C3.91156 4.77344 3.35156 5.33344 3.35156 6.02344L3.35156 12.4484C3.35156 13.1384 3.91156 13.6984 4.60156 13.6984L15.9566 13.6984C16.6466 13.6984 17.2066 13.1384 17.2066 12.4484V6.02344C17.2091 5.33344 16.6466 4.77344 15.9591 4.77344ZM16.2091 12.4484C16.2091 12.5859 16.0966 12.6984 15.9591 12.6984L4.60156 12.6984C4.46406 12.6984 4.35156 12.5859 4.35156 12.4484L4.35156 6.02344C4.35156 5.88594 4.46406 5.77344 4.60156 5.77344L15.9566 5.77344C16.0941 5.77344 16.2066 5.88594 16.2066 6.02344V12.4484H16.2091ZM6.36406 15.4659L14.1991 15.4659V16.4659H6.36406V15.4659Z"/>
          </svg>`,
        },
        {
          id: cmdDeviceTablet,
          command: cmdDeviceTablet,
          label: `<svg ${iconStyle} width="20" height="20" viewBox="0 0 20 20">
          <path fill="currentColor" d="M11.8848 12.3089C11.8848 12.2385 11.8986 12.1689 11.9255 12.1039C11.9525 12.0389 11.9919 11.9798 12.0417 11.9301C12.0914 11.8803 12.1505 11.8409 12.2155 11.8139C12.2805 11.787 12.3501 11.7732 12.4205 11.7732L13.4383 11.7732L13.4383 10.8374C13.4383 10.6954 13.4948 10.5591 13.5952 10.4586C13.6957 10.3582 13.832 10.3017 13.9741 10.3017C14.1161 10.3017 14.2524 10.3582 14.3529 10.4586C14.4533 10.5591 14.5098 10.6954 14.5098 10.8374L14.5098 12.3089C14.5098 12.3792 14.4959 12.4489 14.469 12.5139C14.4421 12.5789 14.4026 12.6379 14.3529 12.6877C14.3031 12.7374 14.2441 12.7769 14.1791 12.8038C14.1141 12.8307 14.0444 12.8446 13.9741 12.8446L12.4348 12.8446C12.3632 12.8465 12.292 12.834 12.2254 12.808C12.1587 12.7819 12.098 12.7428 12.0467 12.6928C11.9954 12.6429 11.9547 12.5832 11.9269 12.5172C11.8991 12.4513 11.8847 12.3804 11.8848 12.3089ZM5.55619 8.68387L5.55619 7.20173C5.55619 7.13138 5.57005 7.06172 5.59697 6.99672C5.6239 6.93172 5.66336 6.87267 5.7131 6.82292C5.76285 6.77318 5.8219 6.73372 5.8869 6.70679C5.9519 6.67987 6.02156 6.66602 6.09191 6.66602L7.46691 6.66602C7.60899 6.66602 7.74525 6.72246 7.84572 6.82292C7.94618 6.92339 8.00262 7.05965 8.00262 7.20173C8.00262 7.34381 7.94618 7.48007 7.84572 7.58054C7.74525 7.681 7.60899 7.73744 7.46691 7.73744L6.62762 7.73744L6.62762 8.68387C6.62762 8.82595 6.57118 8.96221 6.47072 9.06268C6.37025 9.16315 6.23399 9.21959 6.09191 9.21959C5.94983 9.21959 5.81357 9.16315 5.7131 9.06268C5.61264 8.96221 5.55619 8.82595 5.55619 8.68387Z"/>
          <path fill="currentColor" d="M2.35352 13.2366L2.35352 6.29375C2.35352 5.84288 2.53262 5.41048 2.85143 5.09167C3.17025 4.77286 3.60265 4.59375 4.05351 4.59375L16.0321 4.59375C16.4823 4.5947 16.9138 4.77422 17.2319 5.09293C17.5499 5.41164 17.7285 5.8435 17.7285 6.29375L17.7285 13.2366C17.7285 13.6869 17.5499 14.1187 17.2319 14.4374C16.9138 14.7561 16.4823 14.9357 16.0321 14.9366L4.05351 14.9366C3.60265 14.9366 3.17024 14.7575 2.85143 14.4387C2.53262 14.1199 2.35351 13.6875 2.35352 13.2366ZM16.6392 6.29375C16.6392 6.12766 16.5735 5.96832 16.4564 5.85054C16.3393 5.73276 16.1803 5.66612 16.0142 5.66518L4.05351 5.66518C3.88681 5.66518 3.72693 5.7314 3.60905 5.84928C3.49117 5.96716 3.42494 6.12704 3.42494 6.29375L3.42494 13.2366C3.42494 13.3192 3.4412 13.4009 3.47279 13.4772C3.50438 13.5534 3.55068 13.6227 3.60905 13.6811C3.66742 13.7394 3.73671 13.7857 3.81297 13.8173C3.88923 13.8489 3.97097 13.8652 4.05351 13.8652L16.0321 13.8652C16.1982 13.8642 16.3571 13.7976 16.4742 13.6798C16.5914 13.562 16.6571 13.4027 16.6571 13.2366L16.6392 6.29375Z"/>
          </svg>
          `,
        },
        {
          id: cmdDeviceMobile,
          command: cmdDeviceMobile,
          label: `<svg ${iconStyle} width="20" height="20" viewBox="0 0 20 20"">
          <path fill="currentColor" d="M12.3089 8.17969C12.2385 8.17969 12.1689 8.16583 12.1039 8.13891C12.0389 8.11199 11.9798 8.07253 11.9301 8.02278C11.8803 7.97303 11.8409 7.91398 11.8139 7.84898C11.787 7.78399 11.7732 7.71432 11.7732 7.64397V6.62612H10.8374C10.6954 6.62612 10.5591 6.56968 10.4586 6.46921C10.3582 6.36874 10.3017 6.23248 10.3017 6.0904C10.3017 5.94832 10.3582 5.81206 10.4586 5.71159C10.5591 5.61113 10.6954 5.55469 10.8374 5.55469H12.3089C12.3792 5.55469 12.4489 5.56854 12.5139 5.59547C12.5789 5.62239 12.6379 5.66185 12.6877 5.71159C12.7374 5.76134 12.7769 5.8204 12.8038 5.88539C12.8307 5.95039 12.8446 6.02005 12.8446 6.0904V7.62969C12.8465 7.70123 12.834 7.77243 12.808 7.83909C12.7819 7.90574 12.7428 7.9665 12.6928 8.01776C12.6429 8.06903 12.5832 8.10978 12.5172 8.13759C12.4513 8.1654 12.3804 8.17971 12.3089 8.17969ZM8.68387 14.5083H7.20173C7.13138 14.5083 7.06172 14.4944 6.99672 14.4675C6.93173 14.4406 6.87267 14.4011 6.82292 14.3514C6.77318 14.3016 6.73372 14.2425 6.70679 14.1776C6.67987 14.1126 6.66602 14.0429 6.66602 13.9725V12.5975C6.66602 12.4555 6.72246 12.3192 6.82292 12.2187C6.92339 12.1183 7.05965 12.0618 7.20173 12.0618C7.34381 12.0618 7.48007 12.1183 7.58054 12.2187C7.681 12.3192 7.73744 12.4555 7.73744 12.5975L7.73744 13.4368H8.68387C8.82595 13.4368 8.96221 13.4933 9.06268 13.5937C9.16315 13.6942 9.21959 13.8305 9.21959 13.9725C9.21959 14.1146 9.16315 14.2509 9.06268 14.3514C8.96221 14.4518 8.82595 14.5083 8.68387 14.5083Z"/>
          <path fill="currentColor" d="M13.2366 17.6465H6.29375C5.84288 17.6465 5.41048 17.4674 5.09167 17.1486C4.77286 16.8298 4.59375 16.3974 4.59375 15.9465L4.59375 3.96791C4.5947 3.51766 4.77422 3.08618 5.09293 2.76814C5.41164 2.4501 5.8435 2.27148 6.29375 2.27148L13.2366 2.27148C13.6869 2.27148 14.1187 2.4501 14.4374 2.76814C14.7561 3.08618 14.9357 3.51766 14.9366 3.96791L14.9366 15.9465C14.9366 16.3974 14.7575 16.8298 14.4387 17.1486C14.1199 17.4674 13.6875 17.6465 13.2366 17.6465ZM6.29375 3.36077C6.12766 3.36077 5.96832 3.4265 5.85054 3.54361C5.73276 3.66072 5.66612 3.81968 5.66518 3.98577L5.66518 15.9465C5.66518 16.1132 5.7314 16.2731 5.84928 16.391C5.96716 16.5088 6.12704 16.5751 6.29375 16.5751H13.2366C13.3192 16.5751 13.4009 16.5588 13.4772 16.5272C13.5534 16.4956 13.6227 16.4493 13.6811 16.391C13.7394 16.3326 13.7857 16.2633 13.8173 16.187C13.8489 16.1108 13.8652 16.029 13.8652 15.9465L13.8652 3.96791C13.8642 3.80183 13.7976 3.64286 13.6798 3.52575C13.562 3.40864 13.4027 3.34291 13.2366 3.34291L6.29375 3.36077Z"/>
          </svg>`,
        },
      ],
    },
    {
      id: 'options',
      buttons: [
        {
          id: activateOutline,
          command: activateOutline,
          context: activateOutline,
          label: `<svg ${iconStyle} width="20" height="20" viewBox="0 0 20 20">
          <rect fill="white" x="2.72266" y="2.72266" width="14.5556" height="14.5556" rx="1.5" stroke="currentColor" stroke-dasharray="2 2"/>
          </svg>`,
        },
        {
          id: activatePreview,
          context: activatePreview,
          command: activatePreview,
          label: `<svg ${iconStyle} width="20" height="20" viewBox="0 0 20 20">
          <path fill="currentColor" d="M13.5995 10C13.5995 11.9881 11.9879 13.5999 9.99969 13.5999C8.01147 13.5999 6.39984 11.9881 6.39984 10C6.39984 8.01193 8.01147 6.40022 9.99969 6.40022C11.9879 6.40022 13.5995 8.01193 13.5995 10ZM12.3495 10C12.3495 8.70224 11.2973 7.65022 9.99969 7.65022C8.70178 7.65022 7.64984 8.70224 7.64984 10C7.64984 11.2978 8.70178 12.3499 9.99969 12.3499C11.2973 12.3499 12.3495 11.2978 12.3495 10Z"/>
          <path fill="currentColor" d="M1.39618 10.2875C3.07678 13.5875 6.37695 15.625 10.0061 15.625C13.623 15.625 16.9232 13.5875 18.6038 10.2875L18.75 10L18.6038 9.71252C16.9232 6.42502 13.623 4.375 10.0061 4.375C6.37695 4.375 3.07678 6.42502 1.39618 9.71252L1.25 10L1.39618 10.2875ZM10.0061 14.375C6.93726 14.375 4.14825 12.7125 2.63824 10C4.14825 7.28752 6.93726 5.625 10.0061 5.625C13.0627 5.625 15.8517 7.28752 17.374 10C15.8636 12.7125 13.0627 14.375 10.0061 14.375Z"/>
          </svg>`,
        },
        {
          id: activateFullscreen,
          command: activateFullscreen,
          context: activateFullscreen,
          label: `<svg ${iconStyle} width="20" height="20" viewBox="0 0 20 20">
          <path fill="currentColor" d="M3.75 7.5L3.75 5.625C3.75 4.5625 4.5625 3.75 5.625 3.75L7.5 3.75C7.875 3.75 8.125 3.5 8.125 3.125C8.125 2.75 7.875 2.5 7.5 2.5L5.625 2.5C3.875 2.5 2.5 3.875 2.5 5.625L2.5 7.5C2.5 7.875 2.75 8.125 3.125 8.125C3.5 8.125 3.75 7.875 3.75 7.5ZM2.5 12.5V14.375C2.5 16.125 3.875 17.5 5.625 17.5H7.5C7.875 17.5 8.125 17.25 8.125 16.875C8.125 16.5 7.875 16.25 7.5 16.25H5.625C4.5625 16.25 3.75 15.4375 3.75 14.375V12.5C3.75 12.125 3.5 11.875 3.125 11.875C2.75 11.875 2.5 12.125 2.5 12.5ZM17.5 7.5V5.625C17.5 3.875 16.125 2.5 14.375 2.5H12.5C12.125 2.5 11.875 2.75 11.875 3.125C11.875 3.5 12.125 3.75 12.5 3.75H14.375C15.4375 3.75 16.25 4.5625 16.25 5.625V7.5C16.25 7.875 16.5 8.125 16.875 8.125C17.25 8.125 17.5 7.875 17.5 7.5ZM16.25 12.5V14.375C16.25 15.4375 15.4375 16.25 14.375 16.25H12.5C12.125 16.25 11.875 16.5 11.875 16.875C11.875 17.25 12.125 17.5 12.5 17.5H14.375C16.125 17.5 17.5 16.125 17.5 14.375V12.5C17.5 12.125 17.25 11.875 16.875 11.875C16.5 11.875 16.25 12.125 16.25 12.5Z"/>
          </svg>
          `,
        },
        {
          id: openExport,
          command: openExport,
          label: `<svg ${iconStyle} width="20" height="20" viewBox="0 0 20 20">
          <path fill="currentColor" d="M11.1757 3.19727L7.61697 16.4787L8.82437 16.8023L12.3831 3.52079L11.1757 3.19727Z"/>
          <path fill="currentColor" d="M2.68758 9.9998L6.96899 14.2812L6.08511 15.1651L1.45014 10.5301C1.15724 10.2372 1.15725 9.76237 1.45014 9.46947L6.08511 4.8345L6.96899 5.71839L2.68758 9.9998Z"/>
          <path fill="currentColor" d="M17.3078 9.9998L13.0071 14.2518L13.8859 15.1407L18.5463 10.5331C18.8432 10.2396 18.8433 9.76002 18.5463 9.46645L13.8859 4.85894L13.0071 5.74785L17.3078 9.9998Z"/>
          </svg>`,
        },
        {
          id: cmdOpenImport,
          command: cmdOpenImport,
          label: `<svg ${iconStyle} width="20" height="20" viewBox="0 0 20 20">
          <path fill="currentColor" d="M15.3295 7.26734L10.625 11.9718L10.625 0.625L9.37498 0.625002L9.375 11.9718L4.67052 7.26734L3.78663 8.15122L9.64645 14.011C9.84171 14.2063 10.1583 14.2063 10.3536 14.011L16.2134 8.15122L15.3295 7.26734Z" fill="white"/>
          <path fill="currentColor" d="M2.5 13.75L2.5 16.25C2.5 16.9404 3.05964 17.5 3.75 17.5L16.25 17.5C16.9404 17.5 17.5 16.9404 17.5 16.25V13.75H16.25V16.25H3.75L3.75 13.75H2.5Z" fill="white"/>
          </svg>`,
        },
        // {
        //   id: cmdTglImages,
        //   command: cmdTglImages,
        //   label: `<svg ${iconStyle} viewBox="0 0 24 24">
        //   <path fill="currentColor" d="M5 3C3.9 3 3 3.9 3 5V19C3 20.11 3.9 21 5 21H14.09C14.03 20.67 14 20.34 14 20C14 19.32 14.12 18.64 14.35 18H5L8.5 13.5L11 16.5L14.5 12L16.73 14.97C17.7 14.34 18.84 14 20 14C20.34 14 20.67 14.03 21 14.09V5C21 3.89 20.1 3 19 3H5M16.47 17.88L18.59 20L16.47 22.12L17.88 23.54L20 21.41L22.12 23.54L23.54 22.12L21.41 20L23.54 17.88L22.12 16.46L20 18.59L17.88 16.47L16.46 17.88Z"/>
        // </svg>`,
        // },
        {
          id: 'undo',
          command: 'core:undo',
          label: `<svg ${iconStyle} width="20" height="20" viewBox="0 0 20 20">
          <path fill="currentColor" d="M5.25995 6.25054L7.31801 4.19248L6.43413 3.30859L3.22074 6.52198C3.02548 6.71724 3.02548 7.03383 3.22074 7.22909L6.43413 10.4425L7.31801 9.55859L5.25995 7.50054L12.5011 7.50054C14.5721 7.50054 16.2511 9.17947 16.2511 11.2505C16.2511 13.3216 14.5721 15.0005 12.5011 15.0005L6.25107 15.0005V16.2505H12.5011C15.2625 16.2505 17.5011 14.012 17.5011 11.2505C17.5011 8.48911 15.2625 6.25054 12.5011 6.25054L5.25995 6.25054Z"/>
          </svg>`,
        },
        {
          id: 'redo',
          command: 'core:redo',
          label: `<svg ${iconStyle} width="20" height="20" viewBox="0 0 20 20">
          <path fill="currentColor" d="M15.1064 6.25054L13.0483 4.19248L13.9322 3.30859L17.0572 6.43359C17.3013 6.67767 17.3013 7.0734 17.0572 7.31748L13.9322 10.4425L13.0483 9.55859L15.1064 7.50054L7.86523 7.50054C5.79417 7.50054 4.11523 9.17947 4.11523 11.2505C4.11523 13.3216 5.79417 15.0005 7.86523 15.0005L14.1152 15.0005V16.2505H7.86523C5.10381 16.2505 2.86523 14.012 2.86523 11.2505C2.86523 8.48911 5.10381 6.25054 7.86523 6.25054L15.1064 6.25054Z"/>
          </svg>`,
        },
        {
          id: cmdClear,
          command: cmdClear,
          label: `<svg ${iconStyle} width="20" height="20" viewBox="0 0 20 20">
          <path fill="currentColor" d="M7.5 15L7.5 7.5H8.75L8.75 15L7.5 15Z"/>
          <path fill="currentColor" d="M11.25 7.5V15H12.5V7.5H11.25Z"/>
          <path fill="currentColor" d="M13.125 3.75L17.5 3.75V5H16.25V17.5C16.25 18.1904 15.6904 18.75 15 18.75L5 18.75C4.30964 18.75 3.75 18.1904 3.75 17.5L3.75 5H2.5V3.75L6.875 3.75L6.875 2.25C6.875 1.69772 7.32272 1.25 7.875 1.25L12.125 1.25C12.6773 1.25 13.125 1.69772 13.125 2.25V3.75ZM8.125 3.75L11.875 3.75L11.875 2.5L8.125 2.5V3.75ZM5 5L5 17.5L15 17.5L15 5L5 5Z"/>
          </svg>`,
        },
      ],
    },
    {
      id: 'views',
      buttons: [
        {
          id: openStyleManager,
          command: openStyleManager,
          active: true,
          label: `<svg ${iconStyle} width="16" height="16" viewBox="0 0 16 16">
          <path fill="currentColor" d="M10.881 1.7364L14.1243 4.97978L14.8314 4.27268L11.5881 1.0293L10.881 1.7364Z" fill="white"/>
          <path fill="currentColor" d="M2.35119 13.8627L5.96415 13.1401L13.2618 5.84249L10.0184 2.59912L2.72077 9.89672L1.99818 13.5097C1.9562 13.7196 2.14127 13.9047 2.35119 13.8627ZM10.0184 4.01333L11.8475 5.84249L5.47114 12.2189L3.18468 12.6762L3.64197 10.3897L10.0184 4.01333Z"/>
          </svg>`,
        },
        {
          id: openTraits,
          command: openTraits,
          label: `<svg ${iconStyle} width="16" height="16" viewBox="0 0 16 16">
          <path fill="currentColor" d="M10.9997 8C10.9997 9.65685 9.65653 11 7.99968 11C6.34282 11 4.99968 9.65685 4.99968 8C4.99968 6.34315 6.34282 5 7.99968 5C9.65653 5 10.9997 6.34315 10.9997 8ZM9.99968 8C9.99968 6.89543 9.10425 6 7.99968 6C6.89511 6 5.99968 6.89543 5.99968 8C5.99968 9.10457 6.89511 10 7.99968 10C9.10425 10 9.99968 9.10457 9.99968 8Z"/>
          <path fill="currentColor" d="M7.99968 1.25L14.0619 4.625V11.375L7.99968 14.75L1.9375 11.375V4.625L7.99968 1.25ZM2.9375 5.2128V10.7872L7.99968 13.6055L13.0619 10.7872V5.2128L7.99968 2.39453L2.9375 5.2128Z"/>
          </svg>`,
        },
        {
          id: openLayers,
          command: openLayers,
          label: `<svg ${iconStyle} width="16" height="16" viewBox="0 0 16 16">
          <path fill="currentColor" d="M14.0741 4.97706L8.00073 7.50756L1.92738 4.97706C1.51695 4.80605 1.51695 4.19955 1.92738 4.02855L8.00073 1.49805L14.0741 4.02855C14.4845 4.19955 14.4845 4.80605 14.0741 4.97706ZM3.42825 4.5028L8.00073 6.40795L12.5732 4.5028L8.00073 2.59765L3.42825 4.5028Z"/>
          <path fill="currentColor" d="M1.5 7.02579V8.25294L8.00099 11.1111L14.5 8.25381V7.02666L8.00099 9.88394L1.5 7.02579Z"/>
          <path fill="currentColor" d="M1.5 10.4186V11.6457L8.00108 14.5039L14.5 11.6467V10.4195L8.00108 13.2768L1.5 10.4186Z"/>
          </svg>`,
        },
        {
          id: openBlocks,
          command: openBlocks,
          label: `<svg ${iconStyle} width="16" height="16" viewBox="0 0 16 16">
          <path fill="currentColor" d="M4 3H13V12H14V3C14 2.44772 13.5523 2 13 2H4V3Z"/>
          <path fill="currentColor" d="M6.58325 9.41669V12.3334L7.58325 12.3334V9.41669H10.3334V8.41669H7.58325V5.66669H6.58325V8.41669H3.66675V9.41669H6.58325Z"/>
          <path fill="currentColor" d="M2 13C2 13.5523 2.44772 14 3 14L11 14C11.5523 14 12 13.5523 12 13L12 5C12 4.44772 11.5523 4 11 4H3C2.44772 4 2 4.44772 2 5V13ZM3 5L11 5L11 13L3 13L3 5Z"/>
          </svg>`,
        },
      ],
    },
  ]);

  // On component change show the Style Manager
  opts.showStylesOnChange &&
    editor.on('component:selected', () => {
      const openLayersBtn = Panels.getButton('views', openLayers);

      // Don't switch when the Layer Manager is on or there is no selected components
      if (
        (!openLayersBtn || !openLayersBtn.get('active')) &&
        editor.getSelected()
      ) {
        const openSmBtn = Panels.getButton('views', openStyleManager);
        openSmBtn?.set('active', true);
      }
    });

  // Do stuff on load
  editor.onReady(() => {
    if (opts.showBlocksOnLoad) {
      const openBlocksBtn = Panels.getButton('views', openBlocks);
      openBlocksBtn?.set('active', true);
    }
  });
};
